<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBTI人格测试 - OmvianHub</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="css/main.css" rel="stylesheet">
    <link href="css/mobile.css" rel="stylesheet">
    <link href="css/intro.css" rel="stylesheet">
    <!-- 关键CSS内联 - 用于首屏快速渲染 -->
    <style>
        /* 基础样式 */
        :root {
            --primary-color: #BB86FC;
            --text-color: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --success-color: #4CAF50;
            --background-color: #121212;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* 子页面头部关键样式 */
        .subpage-header {
            background: linear-gradient(135deg, rgba(26, 26, 26, 0.95) 0%, rgba(45, 45, 45, 0.95) 100%);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(187, 134, 252, 0.2);
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .page-title h1 {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-color);
            margin: 0;
        }

        /* 主内容区域关键样式 */
        .subpage-main {
            max-width: 800px;
            margin: 0 auto;
            padding: 8px 24px; /* 进一步减少顶部内边距 */
        }

        /* 测试介绍页面关键样式 */
        .test-intro {
            text-align: center;
            min-height: calc(100vh - 120px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px 20px;
            width: 100%;
            margin: 0;
        }

        .intro-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 24px;
            margin-bottom: 40px;
        }

        .btn-start-test {
            padding: 20px 60px;
            font-size: 22px;
            font-weight: 700;
            margin: 40px 0;
            border-radius: 50px;
            background: linear-gradient(135deg, #BB86FC 0%, #A876E8 100%);
            color: white;
            border: none;
            cursor: pointer;
        }

        /* 问题卡片关键样式 */
        .question-card {
            background: rgba(30, 30, 40, 0.7);
            border: 1px solid rgba(187, 134, 252, 0.2);
            border-radius: 24px;
            padding: 40px;
            margin: 0 auto;
            width: 100%;
            max-width: 800px;
        }

        .question-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 30px;
        }

        .option-btn {
            padding: 15px 20px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
        }
    </style>

    <!-- 延迟加载非关键CSS -->
    <script>
        // 延迟加载CSS文件
        function loadCSS(href) {
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = href;
            document.head.appendChild(link);
        }

        // 优先加载关键CSS
        loadCSS('../../src/css/variables.css');
        loadCSS('../../src/css/base.css');
        loadCSS('css/main.css');

        // 页面加载完成后加载非关键CSS
        window.addEventListener('load', function() {
            // 延迟加载其他样式
            setTimeout(() => {
                loadCSS('../../src/css/components/buttons.css');
                loadCSS('../../src/css/main.css');
                loadCSS('../../src/css/mobile.css');
                loadCSS('../../src/css/auth-styles.css');
            }, 500);
        });
    </script>
    <link rel="icon" href="../../favicon.ico">
</head>
<body class="loading">
    <!-- 加载页面 -->
    <div id="loader" class="loader">
        <div class="loader-container">
            <div class="loader-logo">
                <i class="material-icons">psychology</i>
            </div>
            <div class="loader-spinner">
                <div class="spinner-circle"></div>
                <div class="spinner-text">加载中...</div>
            </div>
            <div class="loader-progress">
                <div class="progress-track">
                    <div class="progress-fill" id="loaderProgressFill"></div>
                </div>
                <div class="progress-percentage" id="loaderProgressText">0%</div>
            </div>
        </div>
    </div>
    <!-- 子页面头部 -->
    <header class="subpage-header">
        <div class="header-left">
            <a href="../../index.html" class="back-btn">
                <i class="material-icons">arrow_back</i>
                <span>返回主页</span>
            </a>
            <div class="page-title">
                <i class="material-icons">psychology</i>
                <h1>MBTI</h1>
            </div>
        </div>
        
        <!-- 顶部栏不再包含进度条 -->
        
        <!-- 统一账号组件 -->
        <auth-header id="mbtiAuthHeader"></auth-header>
    </header>

    <!-- 主内容区域 -->
    <main class="subpage-main">
        <!-- 测试问题和结果将在这里显示 -->
    </main>

    <!-- 测试介绍页面 - 移出subpage-main层级以适应全屏背景 -->
    <div id="testIntro" class="test-intro">
            <div class="intro-header">
                <div class="intro-icon">
                    <i class="material-icons">psychology</i>
                </div>
                <div class="intro-title">
                    <h2>MBTI人格测试</h2>
                    <p class="intro-subtitle">了解你的性格特点、优势和发展方向</p>
                </div>
            </div>
            
            <!-- 测试信息 - 简化版 -->
            <div class="test-info-compact">
                <div class="info-pill"><i class="material-icons">quiz</i> 48题</div>
                <div class="info-pill"><i class="material-icons">schedule</i> 10-15分钟</div>
                <div class="info-pill"><i class="material-icons">analytics</i> 16种类型</div>
            </div>
            
            <!-- 开始测试按钮 -->
            <button class="btn-start-test pulse-animation" id="startTestBtn">
                <i class="material-icons">play_arrow</i>
                开始测试
            </button>
            
            <!-- 维度简介 - 简化版 -->
            <div class="dimensions-compact">
                <div class="dimension-row">
                    <div class="dimension-pill">
                        <span class="dimension-letter">E/I</span>
                        <span class="dimension-name">外向/内向</span>
                    </div>
                    <div class="dimension-pill">
                        <span class="dimension-letter">S/N</span>
                        <span class="dimension-name">感觉/直觉</span>
                    </div>
                </div>
                <div class="dimension-row">
                    <div class="dimension-pill">
                        <span class="dimension-letter">T/F</span>
                        <span class="dimension-name">思考/情感</span>
                    </div>
                    <div class="dimension-pill">
                        <span class="dimension-letter">J/P</span>
                        <span class="dimension-name">判断/知觉</span>
                    </div>
                </div>
            </div>
            
            <!-- 简化的测试建议 -->
            <div class="tips-compact">
                <div class="tip-item"><i class="material-icons">check_circle</i> 根据真实想法作答</div>
                <div class="tip-item"><i class="material-icons">check_circle</i> 相信第一直觉</div>
            </div>
            
            <p class="disclaimer">测试结果仅供参考，不能替代专业心理评估</p>
        </div>

        <!-- 测试问题页面 - 现代化设计 -->
        <div id="testQuestions" class="test-questions" style="display: none;">
            <!-- 新位置的进度条 -->
            <div class="test-progress-container" id="testProgress" style="display: none;">
                <div class="test-progress">
                    <div class="progress-info">
                        <span class="progress-text">
                            <span id="currentQuestion">1</span> / <span id="totalQuestions">48</span>
                        </span>
                        <div class="music-control-btn" id="musicControlBtn">
                            <i class="material-icons" id="musicIcon">play_circle</i>
                        </div>
                        <div class="progress-percentage">
                            <span id="progressPercentage">0%</span>
                        </div>
                    </div>
                    <div class="progress-stage-indicator">
                        <div class="stage" id="stage1"></div>
                        <div class="stage-circle" id="stageCircle1"></div>
                        <div class="stage" id="stage2"></div>
                        <div class="stage-circle" id="stageCircle2"></div>
                        <div class="stage" id="stage3"></div>
                        <div class="stage-circle" id="stageCircle3"></div>
                        <div class="stage" id="stage4"></div>
                        <div class="stage-circle" id="stageCircle4"></div>
                    </div>
                    <div class="stage-labels-container">
                        <div class="stage-label">外向/内向</div>
                        <div class="stage-label">感觉/直觉</div>
                        <div class="stage-label">思考/情感</div>
                        <div class="stage-label">判断/感知</div>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                </div>
            </div>
            
            <div class="question-container" style="display: none;">
                <!-- 左侧装饰元素 -->
                <div class="question-decoration left">
                    <div class="decoration-circle"></div>
                    <div class="decoration-line"></div>
                    <div class="decoration-circle"></div>
                </div>
                
                <div class="question-card" id="questionCard">
                    <div class="question-header">
                        <div class="question-title-container">
                            <!-- 音乐按钮将通过JavaScript动态添加到这里 -->
                            <div class="question-category" id="questionCategory">外向/内向</div>
                        </div>
                    </div>


                    <div class="question-content">
                        <div class="question-illustration">
                            <div class="illustration-icon">
                                <i class="material-icons" id="questionIcon">psychology</i>
                            </div>
                        </div>
                        <div class="question-text" id="questionText">问题内容将在这里显示</div>
                    </div>
                    
                    <div class="question-options" id="questionOptions">
                        <!-- 选项将通过JavaScript动态生成 -->
                    </div>
                    

                </div>
                
                <!-- 右侧装饰元素 -->
                <div class="question-decoration right">
                    <div class="decoration-circle"></div>
                    <div class="decoration-line"></div>
                    <div class="decoration-circle"></div>
                </div>
            </div>
            
            <div class="question-navigation" style="display: none;">
                <button class="nav-btn prev-btn" id="prevBtn" disabled>
                    <i class="material-icons">arrow_back</i>
                </button>
                
                <button class="nav-btn next-btn" id="nextBtn" disabled>
                    <i class="material-icons">arrow_forward</i>
                </button>
            </div>
        </div>

        <!-- 测试结果页面 -->
        <div id="testResults" class="test-results" style="display: none;">
            <div class="results-container">
                <div class="result-header">
                    <div class="result-type" id="resultType">INTJ</div>
                    <h2 class="result-title" id="resultTitle">建筑师</h2>
                    <p class="result-subtitle" id="resultSubtitle">富有想象力和战略性的思想家</p>
                </div>

                <div class="result-content">
                    <div class="result-description" id="resultDescription">
                        <!-- 结果描述将通过JavaScript填充 -->
                    </div>

                    <div class="result-dimensions" id="resultDimensions">
                        <!-- 维度分析将通过JavaScript填充 -->
                    </div>

                    <div class="result-characteristics" id="resultCharacteristics">
                        <!-- 特征分析将通过JavaScript填充 -->
                    </div>
                </div>

                <div class="result-actions">
                    <button class="btn btn-primary" id="shareResultBtn">
                        <i class="material-icons">share</i>
                        分享结果
                    </button>
                    <button class="btn btn-secondary" id="saveResultBtn">
                        <i class="material-icons">download</i>
                        保存结果
                    </button>
                    <button class="btn btn-secondary" id="retakeTestBtn">
                        <i class="material-icons">refresh</i>
                        重新测试
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- 子页面页脚 -->
    <footer class="subpage-footer">
        <p>© 2025 OmvianHub. 保留所有权利. | <a href="../../index.html">返回主页</a></p>
    </footer>

    <!-- 登录模态框 -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>登录</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">邮箱</label>
                    <input type="email" id="username" placeholder="请输入您的邮箱" required>
                    <div id="usernameError" class="form-error"></div>
                </div>
                <div class="form-group">
                    <label for="password">密码</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="password" placeholder="请输入您的密码" required>
                        <button type="button" class="password-toggle" data-target="password">
                            <i class="material-icons">visibility</i>
                        </button>
                    </div>
                    <div id="passwordError" class="form-error"></div>
                </div>
                <div class="form-group checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="rememberMe" onchange="if(this.checked && window.showWarning) window.showWarning('注意：您已启用自动登录，这可能存在安全风险，请勿在公共设备上使用此功能', 6000);">
                        <span class="checkbox-text">自动登录</span>
                    </label>
                </div>
                <button type="submit" class="btn btn-primary modal-btn" id="loginSubmitBtn">
                    <div class="button-content">
                        <span id="loginSpinner" class="spinner" style="display: none;">
                            <i class="material-icons rotating">refresh</i>
                        </span>
                        <span id="loginButtonText">登录</span>
                    </div>
                </button>
            </form>
        </div>
    </div>

    <!-- 注册展开界面 -->
    <div id="registerOverlay" class="register-overlay">
        <div class="register-overlay-content">
            <div class="register-overlay-header">
                <h2>注册</h2>
                <button class="register-overlay-close" id="registerCloseBtn">
                    <i class="material-icons">close</i>
                </button>
            </div>
            <form id="registerForm" class="register-overlay-form">
                <div class="form-group">
                    <label for="regEmail">邮箱</label>
                    <div class="input-wrapper">
                        <input type="email" id="regEmail" placeholder="请输入有效的邮箱地址" required>
                        <button type="button" class="clear-input-btn" data-target="regEmail" style="display: none;">
                            <i class="material-icons">close</i>
                        </button>
                    </div>
                    <div id="regEmailError" class="form-error"></div>
                </div>
                <div class="form-group">
                    <label for="regNickname">昵称</label>
                    <div class="input-wrapper">
                        <input type="text" id="regNickname" placeholder="请输入昵称 (2-20个字符)" required>
                        <button type="button" class="clear-input-btn" data-target="regNickname" style="display: none;">
                            <i class="material-icons">close</i>
                        </button>
                    </div>
                    <div id="regNicknameError" class="form-error"></div>
                </div>
                <div class="form-group">
                    <label for="regPassword">密码</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="regPassword" placeholder="请输入强密码 (6-20位，包含字母数字)" required minlength="6" maxlength="20">
                        <button type="button" class="password-toggle" data-target="regPassword">
                            <i class="material-icons">visibility</i>
                        </button>
                    </div>
                    <div id="passwordStrength" class="password-strength">
                        <div id="passwordStrengthBar" class="password-strength-bar"></div>
                    </div>
                    <div id="passwordStrengthText" class="password-strength-text"></div>
                    <div id="regPasswordError" class="form-error"></div>
                </div>
                <div class="form-group" id="confirmPasswordGroup" style="display: none;">
                    <label for="regConfirmPassword">确认密码</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="regConfirmPassword" placeholder="请再次输入密码确保一致" required minlength="6" maxlength="20">
                        <button type="button" class="password-toggle" data-target="regConfirmPassword">
                            <i class="material-icons">visibility</i>
                        </button>
                    </div>
                    <div id="regConfirmPasswordError" class="form-error"></div>
                </div>
                <button type="submit" class="btn btn-primary modal-btn breathing btn-hidden" id="registerSubmitBtn">
                    <div class="button-content">
                        <span id="registerSpinner" class="spinner" style="display: none;">
                            <span class="dot dot1"></span>
                            <span class="dot dot2"></span>
                            <span class="dot dot3"></span>
                        </span>
                        <span id="registerButtonText">注册</span>
                    </div>
                </button>
            </form>
        </div>
    </div>

    <!-- 邮箱验证提示框 -->
    <div id="emailVerificationModal" class="modal">
        <div class="modal-content">
            <div class="email-verification-content">
                <div class="email-verification-icon">
                    <i class="material-icons success-icon">check_circle</i>
                    <i class="material-icons email-icon">mail</i>
                </div>
                <h2 class="email-verification-title">注册成功</h2>
                <p class="email-verification-message">
                    请到邮箱内确认邮件，验证邮箱后即可登录
                </p>
                <div class="email-verification-email" id="verificationEmailDisplay"></div>
                <div class="email-verification-tips">
                    <div class="tips-title">
                        <i class="material-icons">info</i>
                        温馨提示
                    </div>
                    <ul class="tips-list">
                        <li><i class="material-icons">check</i>请检查邮箱收件箱和垃圾邮件文件夹</li>
                        <li><i class="material-icons">check</i>验证邮件可能需要几分钟才能到达</li>
                        <li><i class="material-icons">check</i>点击邮件中的验证链接完成注册</li>
                    </ul>
                </div>
                <button class="btn btn-primary email-verification-close" id="emailVerificationCloseBtn">
                    我知道了
                </button>
            </div>
        </div>
    </div>

    <!-- 全局通知容器 -->
    <div id="notification" class="notification"></div>

    <!-- 脚本加载 -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

    <!-- 子页面认证系统依赖 - 按主页面顺序加载 -->
    <script src="../../src/js/utils/logger.js"></script>
    <script src="../../src/js/utils/constants.js"></script>
    <script src="../../src/js/core/config-manager.js"></script>
    <script src="../../src/js/ui/notification-manager.js"></script>
    <script src="../../src/js/utils/helpers.js"></script>
    <script src="../../src/js/utils/button-state-manager.js"></script>
    <script src="../../src/js/utils/cookie-manager.js"></script>
    <script src="../../src/js/auth/form-validator.js"></script>
    <script src="../../src/js/auth/auth-sync-manager.js"></script>
    <script src="../../src/js/auth/auth-manager.js"></script>
    <script src="../../src/components/auth-header.js"></script>
    <script src="../../src/js/auth-header-adapter.js"></script>

    <!-- MBTI测试功能脚本 -->
    <script src="mbti-data.js"></script>
    <script src="mbti-core.js"></script>
    <script src="mbti-ui.js"></script>
    <script src="mbti-auth.js"></script>
    <script src="mbti-storage.js"></script>
    <script src="mbti-utils.js"></script>
    <script src="mbti-main.js"></script>

    <!-- 加载页面控制脚本 -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 获取加载元素
            const loader = document.getElementById('loader');
            const progressBar = document.getElementById('loaderProgressFill');
            const progressText = document.getElementById('loaderProgressText');
            const body = document.body;
            
            // 模拟加载进度
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 100) {
                    progress = 100;
                    clearInterval(interval);
                }
                
                progressBar.style.width = `${progress}%`;
                progressText.textContent = `加载中...${Math.round(progress)}%`;
                
                if (progress === 100) {
                    // 加载完成，隐藏加载页面
                    setTimeout(() => {
                        loader.classList.add('hidden');
                        // 移除loading类并添加loaded类
                        body.classList.remove('loading');
                        body.classList.add('loaded');
                    }, 500);
                }
            }, 300);
        });
    </script>
</body>
</html>